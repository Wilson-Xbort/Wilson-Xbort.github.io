<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Gelasio:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wilson-xbort.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="TCP协议详解 TCP服务的特点 传输层协议主要有两个：TCP协议和UDP协议。TCP协议相对于UDP协议的特点是：面向连接、字节流和可靠传输。  使用TCP协议通信的双方必须先建立连接，然后才能开始数据的读写。双方都必须为该连接分配必要的内核资源，以管理连接的状态和连接上数据的传输。   TCP连接是全双工的，即双方的数据读写可以通过一个连接进行。完成数据交换之后，通信双方都必须断开连接以释放系">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux高性能服务器第三章阅读笔记">
<meta property="og:url" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="TCP协议详解 TCP服务的特点 传输层协议主要有两个：TCP协议和UDP协议。TCP协议相对于UDP协议的特点是：面向连接、字节流和可靠传输。  使用TCP协议通信的双方必须先建立连接，然后才能开始数据的读写。双方都必须为该连接分配必要的内核资源，以管理连接的状态和连接上数据的传输。   TCP连接是全双工的，即双方的数据读写可以通过一个连接进行。完成数据交换之后，通信双方都必须断开连接以释放系">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img1.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img2.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img3.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img4.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img5.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img6.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img7.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img8.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img9.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img10.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img11.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img12.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img13.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img14.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img15.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img16.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img17.PNG">
<meta property="og:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img18.PNG">
<meta property="article:published_time" content="2022-09-25T01:17:45.000Z">
<meta property="article:modified_time" content="2022-10-02T08:58:37.567Z">
<meta property="article:author" content="Willson-Xbort">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="服务器">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img1.PNG">

<link rel="canonical" href="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Linux高性能服务器第三章阅读笔记 | 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

  <!--此处为建站时间 -->
  <!--<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("09/24/2018 23:45:01");
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML ="(ㆆᴗㆆ)本弱已菜菜的存活了"+dnum+"&thinsp;天"; 
        document.getElementById("times").innerHTML = hnum + "&thinsp;时" + mnum + "&thinsp;分" + snum + "&thinsp;秒"; 
    } 
  setInterval("createtime()",250);-->


<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wilson-xbort.github.io/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ico.jpg">
      <meta itemprop="name" content="Willson-Xbort">
      <meta itemprop="description" content="none">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux高性能服务器第三章阅读笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-25 09:17:45" itemprop="dateCreated datePublished" datetime="2022-09-25T09:17:45+08:00">2022-09-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-02 16:58:37" itemprop="dateModified" datetime="2022-10-02T16:58:37+08:00">2022-10-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1>TCP协议详解</h1>
<h2 id="TCP服务的特点">TCP服务的特点</h2>
<p>传输层协议主要有两个：<code>TCP协议</code>和<code>UDP</code>协议。<code>TCP协议</code>相对于<code>UDP协议</code>的特点是：面向连接、字节流和可靠传输。</p>
<blockquote>
<p>使用TCP协议通信的双方必须先建立连接，然后才能开始数据的读写。双方都必须为该连接分配必要的内核资源，以管理连接的状态和连接上数据的传输。</p>
</blockquote>
<blockquote>
<p>TCP连接是<code>全双工的</code>，即双方的数据读写可以通过一个连接进行。完成数据交换之后，通信双方都必须断开连接以释放系统资源。</p>
</blockquote>
<blockquote>
<p>TCP协议的这种连接是<code>一对一</code>的，所以基于广播和多播（目标是多个主机地址）的应用程序不能使用TCP服务。而无连接协议UDP则非常适合于广播和多播。</p>
</blockquote>
<blockquote>
<p>字节流服务和数据报服务的区别。<br>
这种区别对应到实际编程中，则体现为通信双方是否必须执行相同次数的<br>
读、写操作（当然，这只是表现形式）。当发送端应用程序连续执行<br>
多次写操作时，TCP模块先将这些数据放入TCP发送缓冲区中。当TCP<br>
模块真正开始发送数据时，发送缓冲区中这些等待发送的数据可能被<br>
封装成一个或多个TCP报文段发出。因此，<code>TCP模块发送出的TCP报文 段的个数和应用程序执行的写操作次数之间没有固定的数量关系</code>。</p>
</blockquote>
<blockquote>
<p>综上所述，发送端执行的写操作次数和接收端执行的读操作次数<br>
之间<code>没有任何数量关系</code>，这就是<code>字节流</code>的概念：应用程序对数据的发<br>
送和接收是没有边界限制的。UDP则不然。发送端应用程序每执行一<br>
次写操作，UDP模块就将其封装成一个UDP数据报并发送之。接收端<br>
必须及时针对每一个UDP数据报执行读操作（通过recvfrom系统调<br>
用），否则就会丢包（这经常发生在较慢的服务器上）。并且，<code>如果 用户没有指定足够的应用程序缓冲区来读取UDP数据，则UDP数据将 被截断</code>。</p>
</blockquote>
<blockquote>
<p>图3-1和图3-2显示了TCP字节流服务和UDP数据报服务的上述区别。两图中省略了传输层以下的通信细节。</p>
</blockquote>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img1.PNG" alt></p>
<blockquote>
<p>TCP传输是<code>可靠</code>的。首先，TCP协议采用<code>发送应答机制</code>，即发送端<br>
发送的每个TCP报文段都必须得到接收方的应答，才认为这个TCP报文<br>
段传输成功。其次，TCP协议采用<code>超时重传机制</code>，发送端在发送出一个<br>
TCP报文段之后启动定时器，如果在定时时间内未收到应答，它将重发<br>
该报文段。最后，因为TCP报文段最终是以IP数据报发送的，而IP数据<br>
报到达接收端可能乱序、重复，所以TCP协议还会对接收到的TCP报文<br>
段<code>重排、整理</code>，再交付给应用层。</p>
</blockquote>
<h2 id="TCP头部结构">TCP头部结构</h2>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img2.PNG" alt></p>
<h3 id="端口号-bit-16bit">端口号(bit) 16bit</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">16位端口号（port number）：</span><br><span class="line">告知主机该报文段是来自哪里（源端口）以及传给哪个上层协议或应用程序（目的端口）的。</span><br><span class="line"></span><br><span class="line">进行TCP通信时，客户端通常使用系统自动选择的临时端口号，而服务器则使用知名服务端口号。</span><br><span class="line"></span><br><span class="line">所有知名服务使用的端口号都定义在/etc/services文件中。</span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img3.PNG" alt></p>
<h3 id="序号-bit-32bit">序号(bit) 32bit</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">32位序号（sequence number）：一次TCP通信（从TCP连接建立到断开）过程中某一个传输方向上的字节流的每个字节的编号。</span><br><span class="line"></span><br><span class="line">假设主机A和主机B进行TCP通信，A发送给B的第一个TCP报文段中，序号值被系统初始化为某个随机值ISN（Initial Sequence Number，初始序号值）。</span><br><span class="line">那么在该传输方向上（从A到B），后续的TCP报文段中序号值将被系统设置成ISN加上该报文段所携带数据的第一个字节在整个字节流中的偏移。</span><br><span class="line"></span><br><span class="line">例如，某个TCP报文段传送的数据是字节流中的第1025～2048字节，那么该报文段的序号值就是ISN+1025。</span><br><span class="line">另外一个传输方向（从B到A）的TCP报文段的序号值也具有相同的含义。</span><br></pre></td></tr></table></figure>
<h3 id="确认号-bit-32bit">确认号(bit) 32bit</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">32位确认号（acknowledgement number）：用作对另一方发送来的TCP报文段的响应。</span><br><span class="line"></span><br><span class="line">其值是收到的TCP报文段的序号值加1。假设主机A和主机B进行TCP通信，那么A发送出的TCP报文段不仅携带自己的序</span><br><span class="line">号，而且包含对B发送来的TCP报文段的确认号。</span><br><span class="line"></span><br><span class="line">反之，B发送出的TCP报文段也同时携带自己的序号和对A发送来的报文段的确认号。</span><br></pre></td></tr></table></figure>
<h3 id="头部长度-bit-4bit">头部长度(bit) 4bit</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">4位头部长度（header length）标识该IP头部有多少个32 bit字（4字节）。</span><br><span class="line">4(字节）*5行 = 20字节</span><br><span class="line">而选项最多40字节</span><br><span class="line">可以推出TCP头部最长60字节</span><br></pre></td></tr></table></figure>
<h3 id="标志位-bit-6bit">标志位(bit) 6bit</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">URG标志，表示紧急指针（urgent pointer）是否有效。</span><br><span class="line"></span><br><span class="line">ACK标志，表示确认号是否有效。我们称携带ACK标志的TCP报文段为确认报文段。</span><br><span class="line"></span><br><span class="line">PSH标志，提示接收端应用程序应该立即从TCP接收缓冲区中读走数据，为接收后续数据腾出空间（如果应用程序不将接收到的数据</span><br><span class="line">读走，它们就会一直停留在TCP接收缓冲区中）。</span><br><span class="line"></span><br><span class="line">RST标志，表示要求对方重新建立连接。我们称携带RST(reset)标志的TCP报文段为复位报文段。</span><br><span class="line"></span><br><span class="line">SYN标志，表示请求建立一个连接。我们称携带SYN标志的TCP报文段为同步报文段。</span><br><span class="line"></span><br><span class="line">FIN标志，表示通知对方本端要关闭连接了。我们称携带FIN标志的TCP报文段为结束报文段。</span><br></pre></td></tr></table></figure>
<h3 id="窗口大小-bit-16bit">窗口大小(bit) 16bit</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">16位窗口大小（window size）: 是TCP流量控制的一个手段。</span><br><span class="line"></span><br><span class="line">这里说的窗口，指的是接收通告窗口（Receiver Window，RWND）。</span><br><span class="line">它告诉对方本端的TCP接收缓冲区还能容纳多少字节的数据，这样对方就可以控制发送数据的速度。</span><br></pre></td></tr></table></figure>
<h2 id="TCP头部选项（了解）">TCP头部选项（了解）</h2>
<blockquote>
<p>TCP头部的最后一个选项字段（options）是可变长的可选信息。这部分最多包含40字节，因为TCP头部最长是60字节（其中还包含前面讨<br>
论的20字节的固定部分）。</p>
</blockquote>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img4.PNG" alt></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">选项的第一个字段kind说明选项的类型。有的TCP选项没有后面两个字段，仅包含1字节的kind字段。</span><br><span class="line"></span><br><span class="line">第二个字段length（如果有的话）指定该选项的总长度，该长度包括kind字段和length字段占据的2字节。</span><br><span class="line"></span><br><span class="line">第三个字段info（如果有的话）是选项的具体信息。常见的TCP选项有7种，如图3-5所示。</span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img5.PNG" alt></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">kind=0是选项表结束选项。</span><br><span class="line"></span><br><span class="line">kind=1是空操作（nop）选项，没有特殊含义，一般用于将TCP选项的总长度填充为4字节的整数倍。</span><br><span class="line"></span><br><span class="line">kind=2是最大报文段长度选项。TCP连接初始化时，通信双方使用该选项来协商最大报文段长度（Max Segment Size，MSS）。</span><br><span class="line">TCP模块通常将MSS设置为（MTU-40）字节（减掉的这40字节包括20字节的TCP头部和20字节的IP头部）。</span><br><span class="line"></span><br><span class="line">这样携带TCP报文段的IP数据报的长度就不会超过MTU【最大传输单元（Maximum Transmission Unit，MTU）】（假设TCP头部和IP头部都不包含选项字段，并且这也是一般情况），</span><br><span class="line">从而避免本机发生IP分片。对以太网而言，MSS值 是1460（1500-40）字节。</span><br><span class="line"></span><br><span class="line">kind=3是窗口扩大因子选项。TCP连接初始化时，通信双方使用该选项来协商接收通告窗口的扩大因子。</span><br><span class="line">在TCP的头部中，接收通告窗口大小是用16位表示的，故最大为65 535字节，但实际上TCP模块允许的接收通告窗口大小远不止这个数（为了提高TCP通信的吞吐量）。</span><br><span class="line">窗口扩大因子解决了这个问题。假设TCP头部中的接收通告窗口大小是N，窗口扩大因子（移位数）是M，那么TCP报文段的实际接收通告窗口大</span><br><span class="line">小是N乘2M，或者说N左移M位。注意，M的取值范围是0～14。</span><br><span class="line">我们可以通过修改/proc/sys/net/ipv4/tcp_window_scaling内核变量来启用或关闭窗口扩大因子选项。</span><br><span class="line"></span><br><span class="line">kind=4是选择性确认（Selective Acknowledgment，SACK）选项。</span><br><span class="line">TCP通信时，如果某个TCP报文段丢失，则TCP模块会重传最后被确认的TCP报文段后续的所有报文段，这样原先已经正确传输的TCP报文段</span><br><span class="line">也可能重复发送，从而降低了TCP性能。SACK技术正是为改善这种情况而产生的，它使TCP模块只重新发送丢失的TCP报文段，不用发送所</span><br><span class="line">有未被确认的TCP报文段。选择性确认选项用在连接初始化时，表示是否支持SACK技术。我们可以通过修改/proc/sys/net/ipv4/tcp_sack内核变</span><br><span class="line">量来启用或关闭选择性确认选项。</span><br><span class="line"></span><br><span class="line">kind=5是SACK实际工作的选项。</span><br><span class="line">该选项的参数告诉发送方本端已经收到并缓存的不连续的数据块，从而让发送端可以据此检查并重发丢失的数据块。</span><br><span class="line">每个块边沿（edge of block）参数包含一个4字节的序号。其中块左边沿表示不连续块的第一个数据的序号，而块右边沿则</span><br><span class="line">表示不连续块的最后一个数据的序号的下一个序号。这样一对参数（块左边沿和块右边沿）之间的数据是没有收到的。因为一个块信息</span><br><span class="line">占用8字节，所以TCP头部选项中实际上最多可以包含4个这样的不连续数据块（考虑选项类型和长度占用的2字节）。</span><br><span class="line"></span><br><span class="line">kind=8是时间戳选项。该选项提供了较为准确的计算通信双方之间的回路时间（Round Trip Time，RTT）的方法，从而为TCP流量控制提</span><br><span class="line">供重要信息。</span><br><span class="line">我们可以通过修改/proc/sys/net/ipv4/tcp_timestamps内核变量来启用或关闭时间戳选项。</span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img6.PNG" alt><br>
<img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img7.PNG" alt><br>
<img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img8.PNG" alt></p>
<h2 id="使用tcpdump观察TCP头部信息">使用tcpdump观察TCP头部信息</h2>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img9.PNG" alt></p>
<blockquote>
<p>tcpdump输出Flags[S]，表示该TCP报文段包含SYN标志，因此它是<br>
一个同步报文段。如果TCP报文段包含其他标志，则tcpdump也会将该<br>
标志的首字母显示在“Flags”后的方括号中。</p>
</blockquote>
<blockquote>
<p>seq是序号值。因为该同步报文段是从127.0.0.1.41621（客户端IP地<br>
址和端口号）到127.0.0.1.23（服务器IP地址和端口号）这个传输方向<br>
上的第一个TCP报文段，所以这个序号值也就是此次通信过程中该传输<br>
方向的ISN值。并且，因为这是整个通信过程中的第一个TCP报文段，<br>
所以它没有针对对方发送来的TCP报文段的确认值（尚未收到任何对方<br>
发送来的TCP报文段）。</p>
</blockquote>
<blockquote>
<p>win是接收通告窗口的大小。因为这是一个同步报文段，所以win<br>
值反映的是实际的接收通告窗口大小。</p>
</blockquote>
<blockquote>
<p>options是TCP选项，其具体内容列在方括号中。mss是发送端（客<br>
户端）通告的最大报文段长度。通过ifconfig命令查看回路接口的MTU<br>
为16436字节，因此可以预想到TCP报文段的MSS为16396（16436-40）<br>
字节。sackOK表示发送端支持并同意使用SACK选项。TS val是发送端<br>
的时间戳。ecr是时间戳回显应答。因为这是一次TCP通信的第一个<br>
TCP报文段，所以它针对对方的时间戳的应答为0（尚未收到对方的时<br>
间戳）。紧接着的nop是一个空操作选项。wscale指出发送端使用的窗<br>
口扩大因子为6。</p>
</blockquote>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img10.PNG" alt></p>
<h1>TCP连接的建立和关闭</h1>
<h2 id="使用tcpdump观察TCP连接的建立和关闭">使用tcpdump观察TCP连接的建立和关闭</h2>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img11.PNG" alt></p>
<blockquote>
<p>当执行telnet命令并在两台通信主机之间建立TCP连接后（telnet输 出“Connected to 192.168.1.109”），输入Ctrl+]以调出telnet程序的命令提<br>
示符，然后在telnet命令提示符后输入quit以退出telnet客户端程序，从<br>
而结束TCP连接。整个过程中（从连接建立到结束），tcpdump输出的<br>
内容如代码清单3-2所示。</p>
</blockquote>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img12.PNG" alt></p>
<blockquote>
<p>因为整个过程并没有发生应用层数据的交换，所以TCP报文段的数<br>
据部分的长度（length）总是0。为了更清楚地表示建立和关闭TCP连接<br>
的整个过程，我们将tcpdump输出的内容绘制成图3-6所示的时序图。</p>
</blockquote>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img13.PNG" alt></p>
<blockquote>
<p>第1个TCP报文段包含<code>SYN</code>标志，因此它是一个同步报文段，即<br>
ernest-laptop（客户端）向Kongming20（服务器）<code>发起连接请求</code>。同<br>
时，该同步报文段包含一个ISN值为535734930的序号。第2个TCP报文<br>
段也是同步报文段，表示Kongming20同意与ernest-laptop建立连接。同<br>
时它发送自己的ISN值为2159701207的序号，并对第1个同步报文段进<br>
行确认。确认值是535734931，即第1个同步报文段的序号值加1。前文<br>
说过，序号值是用来标识TCP数据流中的每一字节的。但同步报文段比<br>
较特殊，即使它并没有携带任何应用程序数据，它也要占用一个序号<br>
值。第3个TCP报文段是ernest-laptop对第2个同步报文段的确认。至<br>
此，TCP连接就建立起来了。建立TCP连接的这3个步骤被称为TCP三<br>
次握手。</p>
</blockquote>
<blockquote>
<p>从第3个TCP报文段开始，tcpdump输出的序号值和确认值都是相对<br>
初始ISN值的偏移。当然，我们可以开启tcpdump的-S选项来选择打印<br>
序号的绝对值。</p>
</blockquote>
<blockquote>
<p>后面4个TCP报文段是关闭连接的过程。第4个TCP报文段包含FIN<br>
标志，因此它是一个结束报文段，即ernest-laptop要求关闭连接。结束<br>
报文段和同步报文段一样，也要占用一个序号值。Kongming20用TCP<br>
报文段5来确认该结束报文段。紧接着Kongming20发送自己的结束报文<br>
段6，ernest-laptop则用TCP报文段7给予确认。实际上，仅用于确认目<br>
的的确认报文段5是可以省略的，因为结束报文段6也携带了该确认信<br>
息。确认报文段5是否出现在连接断开的过程中，取决于TCP的延迟确<br>
认特性。延迟确认将在后面讨论。</p>
</blockquote>
<blockquote>
<p>在连接的关闭过程中，因为ernest-laptop先发送结束报文段（telnet<br>
客户端程序主动退出），故称ernest-laptop执行主动关闭，而称<br>
Kongming20执行被动关闭。</p>
</blockquote>
<blockquote>
<p>一般而言，TCP连接是由客户端发起，并通过三次握手建立（特殊<br>
情况是所谓同时打开[1]）的。TCP连接的关闭过程相对复杂一些。可能<br>
是客户端执行主动关闭，比如前面的例子；也可能是服务器执行主动<br>
关闭，比如服务器程序被中断而强制关闭连接；还可能是同时关闭<br>
（和同时打开一样，非常少见）。</p>
</blockquote>
<h2 id="半关闭状态">半关闭状态</h2>
<blockquote>
<p>TCP连接是全双工的，所以它允许两个方向的数据传输被独立关<br>
闭。换言之，通信的一端可以发送结束报文段给对方，告诉它本端已<br>
经完成了数据的发送，但允许继续接收来自对方的数据，直到对方也<br>
发送结束报文段以关闭连接。TCP连接的这种状态称为半关闭（half<br>
close）状态，如图3-7所示。</p>
</blockquote>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img14.PNG" alt></p>
<blockquote>
<p>请注意，在图3-7中，服务器和客户端应用程序判断对方是否已经<br>
关闭连接的方法是：read系统调用返回0（收到结束报文段）。当然，<br>
Linux还提供其他检测连接是否被对方关闭的方法，这将在后续章节讨<br>
论。</p>
</blockquote>
<blockquote>
<p>socket网络编程接口通过shutdown函数提供了对半关闭的支持，我<br>
们将在后续章节讨论它。这里强调一下，虽然我们介绍了半关闭状<br>
态，但是使用半关闭的应用程序很少见。</p>
</blockquote>
<h2 id="连接超时">连接超时</h2>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img15.PNG" alt><br>
<img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img16.PNG" alt><br>
<img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img17.PNG" alt></p>
<blockquote>
<p>这次抓包我们保留了tcpdump输出的时间戳（不使用其-t选项），<br>
以便推理Linux的超时重连策略。<br>
我们一共抓取到6个TCP报文段，它们都是同步报文段，并且具有<br>
相同的序号值，这说明后面5个同步报文段都是超时重连报文段。观察<br>
这些TCP报文段被发送的时间间隔，它们分别为1s、2s、4s、8s和<br>
16s（由于定时器精度的问题，这些时间间隔都有一定偏差），可以推<br>
断最后一个TCP报文段的超时时间是32s（63s-16s-8s-4s-2s-1s）。因<br>
此，TCP模块一共执行了5次重连操作，这是<br>
由/proc/sys/net/ipv4/tcp_syn_retries内核变量所定义的。每次重连的超时<br>
时间都增加一倍。在5次重连均失败的情况下，TCP模块放弃连接并通<br>
知应用程序。</p>
</blockquote>
<h2 id="TCP状态转移">TCP状态转移</h2>
<blockquote>
<p>TCP连接的任意一端在任一时刻都处于某种状态，当前状态可以通<br>
过netstat命令（见第17章）查看。本节我们要讨论的是TCP连接从建立<br>
到关闭的整个过程中通信两端状态的变化。图3-8是完整的状态转移<br>
图，它描绘了所有的TCP状态以及可能的状态转换。</p>
</blockquote>
<p><img src="/2022/09/25/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%B8%89%E7%AB%A0%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/Linux_Server_C3_img18.PNG" alt></p>
<blockquote>
<p>图3-8中的粗虚线表示典型的服务器端连接的状态转移；粗实线表<br>
示典型的客户端连接的状态转移。CLOSED是一个假想的起始点，并<br>
不是一个实际的状态。</p>
</blockquote>

    </div>

    
    
    

    <!-- after add -->
    
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

    
       <!-- after add finish -->


      


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i># C++</a>
              <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i># 服务器</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/09/19/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AC%AC%E4%BA%8C%E7%AB%A0/" rel="prev" title="Linux高性能服务器第二章">
      <i class="fa fa-chevron-left"></i> Linux高性能服务器第二章
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">TCP协议详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%89%B9%E7%82%B9"><span class="nav-number">1.1.</span> <span class="nav-text">TCP服务的特点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP%E5%A4%B4%E9%83%A8%E7%BB%93%E6%9E%84"><span class="nav-number">1.2.</span> <span class="nav-text">TCP头部结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E5%8F%B7-bit-16bit"><span class="nav-number">1.2.1.</span> <span class="nav-text">端口号(bit) 16bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%8F%E5%8F%B7-bit-32bit"><span class="nav-number">1.2.2.</span> <span class="nav-text">序号(bit) 32bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AE%E8%AE%A4%E5%8F%B7-bit-32bit"><span class="nav-number">1.2.3.</span> <span class="nav-text">确认号(bit) 32bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E9%83%A8%E9%95%BF%E5%BA%A6-bit-4bit"><span class="nav-number">1.2.4.</span> <span class="nav-text">头部长度(bit) 4bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E5%BF%97%E4%BD%8D-bit-6bit"><span class="nav-number">1.2.5.</span> <span class="nav-text">标志位(bit) 6bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F-bit-16bit"><span class="nav-number">1.2.6.</span> <span class="nav-text">窗口大小(bit) 16bit</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP%E5%A4%B4%E9%83%A8%E9%80%89%E9%A1%B9%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="nav-number">1.3.</span> <span class="nav-text">TCP头部选项（了解）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8tcpdump%E8%A7%82%E5%AF%9FTCP%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF"><span class="nav-number">1.4.</span> <span class="nav-text">使用tcpdump观察TCP头部信息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">2.</span> <span class="nav-text">TCP连接的建立和关闭</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8tcpdump%E8%A7%82%E5%AF%9FTCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B%E5%92%8C%E5%85%B3%E9%97%AD"><span class="nav-number">2.1.</span> <span class="nav-text">使用tcpdump观察TCP连接的建立和关闭</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8A%E5%85%B3%E9%97%AD%E7%8A%B6%E6%80%81"><span class="nav-number">2.2.</span> <span class="nav-text">半关闭状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6"><span class="nav-number">2.3.</span> <span class="nav-text">连接超时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB"><span class="nav-number">2.4.</span> <span class="nav-text">TCP状态转移</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Willson-Xbort"
      src="/images/ico.jpg">
  <p class="site-author-name" itemprop="name">Willson-Xbort</p>
  <div class="site-description" itemprop="description">none</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wilson-xbort" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wilson-xbort" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Willson-Xbort</span>

  <!-- after add-->
  <!---->
</div>





        








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
